!function(a){var b=function(a){return this.Storage={isCompatible:function(){return"undefined"!=typeof Storage},put:function(a){if("undefined"==typeof a.key||"undefined"==typeof a.value)throw new Error("Invalid arguments: "+a);localStorage.setItem(a.key,JSON.stringify(a.value))},get:function(a){if("string"!=typeof a)throw new Error("The storage key must be a string.");return localStorage[a]},clear:function(){localStorage.clear()}},this};Allspeak=function(c){"undefined"==typeof c&&(c={});var d=new b,e=null;this.debug=c.debug||!1,this.path=c.path||"./translations",this.defaultDomain=c.defaultDomain||"messages",this.keyAttrName=c.keyAttrName||"data-key",this.domainAttrName=c.domainAttrName||"data-domain",this.raw=c.raw||!1,this.useCache="boolean"==typeof c.useCache?c.useCache:d.Storage.isCompatible(),d.Storage.isCompatible()||console.warn("Your browser is't compatible with localStorage. The cache mode has been disabled.");var f=function(b,c,d){d="boolean"==typeof d?d:!0,a.ajax({url:b,type:"GET",dataType:"json",data:null,async:d}).done(function(a,b){return c&&c(a),a}).fail(function(a,b){return console.warn('An error occurred while loading the translation data: "'+b+'"'),console.warn(a),!1})},g=function(a,b){this.debug&&console.info("Updating element:",a.get(0)),this.raw?a.html(b):a.text(b)},h=function(b,c){var d=c.scope.find("*");d.each(function(d,e){var f=a(e).attr(b.keyAttrName);if("undefined"!=typeof f){if("undefined"==typeof c.data[f])return void console.warn('Unknow translation key "'+f+'", domain "'+c.domain+'"');b.debug&&console.info('Translating from loaded JSON: ["'+f+'", "'+c.locale+'"]');var h=c.data[f][c.locale];return"undefined"==typeof h?void console.warn('Missing translation for ["'+f+'", "'+c.locale+'"], domain "'+c.domain+'"'):void g.bind(b)(a(e),h)}}),a("html").attr("lang",c.locale)};return this.trans=function(b){var c,i=this.defaultDomain,j=a("body"),k=this;"string"==typeof b?c=b:(c=b.locale,i=b.domain||this.defaultDomain,j=b.scope||a("body"));var l=this.path+"/"+i+".json";if(a("html").attr("lang")===c)return this;if(this.useCache){var m=j.find("*");m.each(function(b,h){var j=a(h).attr(k.keyAttrName);if("undefined"!=typeof j){k.debug&&console.info('Translating from storage cache: ["'+j+'", "'+c+'"]');var m=d.Storage.get(j);if(m)m=JSON.parse(d.Storage.get(j))[c];else if(k.debug&&console.info('Key "'+j+'" missing from storage. Updating from cached JSON'),null===e)k.debug&&console.info("No cached JSON data was found."),f(l,function(a){return"undefined"==typeof a[j]?void console.warn('Unknow translation key "'+j+'", domain "'+i+'"'):(m=a[j][c],"undefined"==typeof m?void console.warn('Missing translation for ["'+j+'", "'+c+'"], domain "'+i+'"'):(k.debug&&console.info('Caching the translations for "'+j+'" into storage'),d.Storage.put({key:j,value:a[j]}),void(e=a)))},!1);else{if("undefined"==typeof e[j])return void console.warn('Unknow translation key "'+j+'"');if(m=e[j][c],"undefined"==typeof m)return void console.warn('Missing translation for "'+j+", "+c+'"');k.debug&&console.info('Caching the translations for "'+j+'" into storage'),d.Storage.put({key:j,value:e[j]})}g.bind(k)(a(h),m)}}),a("html").attr("lang",c)}else f(l,function(a){h(k,{scope:j,locale:c,data:a,domain:i})});return this},this.clearCache=function(){return this.debug&&console.info("Clearing translation cache"),e=null,d.Storage.clear(),this},this}}(jQuery);